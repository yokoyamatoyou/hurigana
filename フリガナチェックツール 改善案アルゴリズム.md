### **フリガナチェックツール 改善案アルゴリズム詳細解説**

このドキュメントは、フリガナチェックツールの精度を向上させるための、新しいアルゴリズムの仕様を定義したものです。現在の問題点を解決し、AIの能力を最大限に活用することを目的とします。

### **■【改善案】新しい候補生成アルゴリズム**

現在の非効率な候補生成ロジックを廃止し、以下の新しいアルゴリズムを導入します。このアルゴリズムは、無駄な処理をなくし、多様な候補を効率的に集めることを目的とします。

**処理フロー:**

1. **【Step 1】辞書（Sudachi）による候補取得**  
   * 最初に、Sudachiで名前を解析し、辞書に存在する読み仮名をすべて取得します。  
   * この時点で得られた候補を\*\*「確定済みリスト」\*\*とします。  
2. **【Step 2】GPT（低温）による候補取得**  
   * GPTに対し、Temperature=0（低温）で**3つ**の候補を問い合わせます。  
   * **問い合わせ条件:** 生成する候補は、**「確定済みリスト」に含まれていないもの**に限ります。  
   * 得られた3つのユニークな候補を、「確定済みリスト」に追加します。  
3. **【Step 3】GPT（中温）による候補取得**  
   * GPTに対し、Temperature=0.7（中温）で**5つ**の候補を問い合わせます。  
   * **問い合わせ条件:** 生成する候補は、**「確定済みリスト」（Step 1と2で得られた全ての候補）に含まれていないもの**に限ります。  
   * 得られた5つのユニークな候補を、「確定済みリスト」に追加します。  
4. **【Step 4】最終候補リストの完成**  
   * 最終的に「確定済みリスト」には、\*\*最大で「辞書候補 \+ 低温3件 \+ 中温5件」\*\*の、すべて重複しない読み仮名候補が格納されます。  
   * このリストを、後続の「比較・スコアリング」処理に渡します。

### **■ 修正必須のバグと問題点**

上記の新しい候補生成アルゴリズムを実装した上で、**現在抱えている以下のバグを必ず修正する必要があります。**

#### **1\. 比較とスコアリングのロジック修正**

* **【バグ①：2位抜けの修正】**  
  * AI候補の**2位をチェックするロジックを追加**し、80点などの適切なスコアを割り当ててください。  
* **【バグ②：打ち切り問題の修正】**  
  * AI候補を3位で打ち切らず、新しいアルゴリズムで生成された**全ての候補を最後までチェックする**ようにループ処理を修正してください。

#### **2\. 正規化ルールの改善**

* **【問題点：濁音・半濁音の不一致】**  
  * ハとバのような濁点・半濁点の違いを吸収できる、新しい正規化処理を導入してください。（単純に濁点を削除するのではなく、**「濁点だけの違いか」を判定する**精密な方法を推奨します）

これらの修正をすべて行うことで、ツールの精度は飛躍的に向上します。